
MACRO OMEGA [ABS [APP [REF 1] [REF 1]]];;

MACRO NULL [DATA []];;

MACRO CAAR [ABS [CAR [CAR [REF 1]]]];;
MACRO CADR [ABS [CAR [CDR [REF 1]]]];;

MACRO MAP_PUT 
  [ABS // MAP
  [ABS // KEY
  [ABS // VAL
    [CONS [CONS [REF 2] [REF 1]] [REF 3]]
  ]]]
;;

MACRO MAP_GET 
  [ABS // SELF
  [ABS // MAP
  [ABS // KEY
  [ABS // DEFAULT
    [APP [APP [PRIM [DATA BRANCH] [PRIM [DATA EQUALS] [CONS (*NULL*) [REF 3]]]] // IF MAP==NULL
      [REF 1]] // RETURN DEFAULT
      [APP [APP [PRIM [DATA BRANCH] // elsif...
        [PRIM [DATA EQUALS] [CONS [REF 2] [APP (*CAAR*) [REF 3]]]]] // top of map key = KEY
          [CDR [CAR [REF 3]]]]  // then return top of map val
          [APP [APP [APP [APP [REF 4]  // ELSE, recurse
            [REF 4]] 
            [CDR [REF 3]]] 
            [REF 2]]
            [REF 1]]]
    ]
  ]]]]
;;          

MACRO MAP_GET [APP (*OMEGA*) (*MAP_GET*)];;

MACRO GRAMMAR [DATA [
  [ "ROOT"
    "STATEMENT"
    ["SEQ" [["NON_TERM" "STATEMENT"] []]]
  ]
  
  [ "STATEMENT"
    "REDUCE"
    ["SEQ" [["TERM" "REDUCE"] [["NON_TERM" "LOBJECT"] []]]]
  ]

  [ "STATEMENT"
    "SET_PARSER"
    ["SEQ" [["TERM" "SET_PARSER"] [["NON_TERM" "LOBJECT"] []]]]
  ]
  
  [ "STATEMENT"
    "SET_ENV"
    ["SEQ" [["TERM" "SET_ENV"] [["NON_TERM" "LOBJECT"] []]]]
  ]
  
  [ "LOBJECT"
    "PRIM_GET"
    ["SEQ" [["VALUE" "PrimIdent"] []]]
  ]
]];;

MACRO PARSE_NODE [
  
];;

REDUCE [PRIM [DATA LIST_TO_TUPLES] 
  [PRIM [DATA PARSE_STATEMENT] [CONS (*GRAMMAR*) [DATA "REDUCE APP"]]]];;
 